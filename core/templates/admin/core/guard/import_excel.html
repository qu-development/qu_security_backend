{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
    &rsaquo; <a href="{% url 'admin:core_guard_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
    &rsaquo; {% trans 'Import from Excel' %}
</div>
{% endblock %}

{% block content %}
<div class="form-row">
    <div class="fieldBox">

        <div class="help">
            <h3>{% trans "Instructions" %}</h3>
            <p>{% trans "Upload an Excel file (.xlsx) with guard information. Required column:" %}</p>
            <ul>
                <li><strong>NOMBRE Y APELLIDOS</strong> - {% trans "Full name of the guard" %}</li>
            </ul>
            <p>{% trans "Optional columns: INGRESOS, Address, Social Security, Observaciones" %}</p>
        </div>

        <form method="post" enctype="multipart/form-data" class="aligned">
            {% csrf_token %}

            <div class="form-row">
                <div class="field-box">
                    {{ form.excel_file.label_tag }}
                    {{ form.excel_file }}
                    {% if form.excel_file.help_text %}
                        <p class="help">{{ form.excel_file.help_text }}</p>
                    {% endif %}
                    {% if form.excel_file.errors %}
                        <ul class="errorlist">
                            {% for error in form.excel_file.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            <div class="form-row">
                <div class="field-box">
                    {{ form.create_users.label_tag }}
                    {{ form.create_users }}
                    {% if form.create_users.help_text %}
                        <p class="help">{{ form.create_users.help_text }}</p>
                    {% endif %}
                    {% if form.create_users.errors %}
                        <ul class="errorlist">
                            {% for error in form.create_users.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            <div class="form-row" id="password-field">
                <div class="field-box">
                    {{ form.default_password.label_tag }}
                    {{ form.default_password }}
                    {% if form.default_password.help_text %}
                        <p class="help">{{ form.default_password.help_text }}</p>
                    {% endif %}
                </div>
            </div>

            {% if form.non_field_errors %}
                <div class="form-row">
                    <ul class="errorlist">
                        {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <div class="submit-row">
                <input type="submit" value="{% trans 'Import Guards' %}" class="default" />
                <a href="{% url 'admin:core_guard_changelist' %}" class="button cancel-link">{% trans 'Cancel' %}</a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var createUsersCheckbox = document.getElementById('id_create_users');
    var passwordField = document.getElementById('password-field');

    function togglePasswordField() {
        if (createUsersCheckbox.checked) {
            passwordField.style.display = 'block';
        } else {
            passwordField.style.display = 'none';
        }
    }

    createUsersCheckbox.addEventListener('change', togglePasswordField);
    togglePasswordField();
});
</script>
{% endblock %}
